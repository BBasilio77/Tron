<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tron Light Cycles</title>
<style>
    body {
        background: black;
        margin: 0;
        overflow: hidden;
        font-family: monospace;
        color: white;
    }
    canvas {
        display: block;
        margin: auto;
    }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
// ----- Auto Resize -----
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
    const size = Math.min(window.innerWidth, window.innerHeight) * 0.9;
    canvas.width = size;
    canvas.height = size;
}
window.onresize = resizeCanvas;
resizeCanvas();

// ----- Game Settings -----
let speed = 2.8;
const headSize = 10;
const maxRounds = 5;

let player1, player2;
let trail1 = [];
let trail2 = [];
let score1 = 0;
let score2 = 0;
let round = 1;
let gameRunning = false;

// ----- Player Class -----
class Player {
    constructor(x, y, color, dir) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.direction = dir;
        this.nextDirection = dir;
    }

    update() {
        this.direction = this.nextDirection;
        this.x += this.direction.x * speed;
        this.y += this.direction.y * speed;
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 12;
        ctx.fillRect(this.x - headSize/2, this.y - headSize/2, headSize, headSize);
        ctx.shadowBlur = 0;
    }
}

// ----- Explosion -----
function explosion(x, y, color) {
    for (let i = 0; i < 18; i++) {
        let angle = Math.random() * Math.PI * 2;
        let dist = Math.random() * 25;

        ctx.fillStyle = color;
        ctx.fillRect(
            x + Math.cos(angle) * dist,
            y + Math.sin(angle) * dist,
            6, 6
        );
    }
}

// ----- Setup Round -----
function setupRound() {
    gameRunning = true;

    trail1 = [];
    trail2 = [];

    player1 = new Player(canvas.width * 0.25, canvas.height * 0.5, "#00aaff", {x:1, y:0});
    player2 = new Player(canvas.width * 0.75, canvas.height * 0.5, "#ff8800", {x:-1, y:0});

    player1.nextDirection = player1.direction;
    player2.nextDirection = player2.direction;

    loop();
}

// ----- Collision -----
function collided(px, py, trail) {
    for (let t of trail) {
        if (Math.hypot(px - t.x, py - t.y) < headSize) return true;
    }
    return false;
}

// ----- Draw Trail -----
function drawTrail(tr, color) {
    ctx.fillStyle = color;
    ctx.shadowColor = color;
    ctx.shadowBlur = 10;

    for (let t of tr) {
        ctx.fillRect(t.x - headSize/2, t.y - headSize/2, headSize, headSize);
    }

    ctx.shadowBlur = 0;
}

// ----- UI -----
function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = `${canvas.width * 0.04}px monospace`;
    ctx.textAlign = "left";
    ctx.fillText(`P1: ${score1}`, 10, 30);

    ctx.textAlign = "right";
    ctx.fillText(`Round ${round}/${maxRounds}`, canvas.width - 10, 30);

    ctx.textAlign = "center";
    ctx.fillText(`P2: ${score2}`, canvas.width / 2, 30);
}

// ----- End Round -----
function endRound(winner) {
    gameRunning = false;

    if (winner === 1) score1++;
    if (winner === 2) score2++;

    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "white";
    ctx.font = `${canvas.width * 0.06}px monospace`;
    ctx.textAlign = "center";

    ctx.fillText(`Player ${winner} Wins`, canvas.width/2, canvas.height/2 - 40);

    ctx.font = `${canvas.width * 0.04}px monospace`;

    if (round < maxRounds) {
        ctx.fillText("Press P for Next Round", canvas.width/2, canvas.height/2 + 20);
    } else {
        ctx.fillText("Game Over - Press P to Restart", canvas.width/2, canvas.height/2 + 20);
    }
}

// ----- Main Loop -----
function loop() {
    if (!gameRunning) return;

    player1.update();
    player2.update();

    // Save trails
    trail1.push({x: player1.x, y: player1.y});
    trail2.push({x: player2.x, y: player2.y});

    // Collision checks
    if (
        player1.x < 0 || player1.x > canvas.width ||
        player1.y < 0 || player1.y > canvas.height ||
        collided(player1.x, player1.y, trail1.slice(0,-10)) ||
        collided(player1.x, player1.y, trail2)
    ) {
        explosion(player1.x, player1.y, "#00aaff");
        endRound(2);
        return;
    }

    if (
        player2.x < 0 || player2.x > canvas.width ||
        player2.y < 0 || player2.y > canvas.height ||
        collided(player2.x, player2.y, trail2.slice(0,-10)) ||
        collided(player2.x, player2.y, trail1)
    ) {
        explosion(player2.x, player2.y, "#ff8800");
        endRound(1);
        return;
    }

    // Draw everything
    ctx.fillStyle = "black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    drawTrail(trail1, "rgba(0,170,255,0.9)");
    drawTrail(trail2, "rgba(255,140,0,0.9)");

    player1.draw();
    player2.draw();
    drawUI();

    requestAnimationFrame(loop);
}

// ----- Controls -----
document.addEventListener("keydown", e => {
    if (!gameRunning && e.key.toLowerCase() === "p") {
        round++;
        if (round > maxRounds) {
            round = 1;
            score1 = 0;
            score2 = 0;
        }
        setupRound();
        return;
    }

    // Player 1
    if (e.key === "w") player1.nextDirection = {x:0,y:-1};
    if (e.key === "s") player1.nextDirection = {x:0,y:1};
    if (e.key === "a") player1.nextDirection = {x:-1,y:0};
    if (e.key === "d") player1.nextDirection = {x:1,y:0};

    // Player 2
    if (e.key === "ArrowUp") player2.nextDirection = {x:0,y:-1};
    if (e.key === "ArrowDown") player2.nextDirection = {x:0,y:1};
    if (e.key === "ArrowLeft") player2.nextDirection = {x:-1,y:0};
    if (e.key === "ArrowRight") player2.nextDirection = {x:1,y:0};
});

// Start Game
setupRound();

</script>
</body>
</html>
